# Alertmanager 配置文件

global:
  # SMTP 配置 (用于邮件告警)
  smtp_smarthost: 'smtp.example.com:587'
  smtp_from: 'alertmanager@example.com'
  smtp_auth_username: 'alertmanager@example.com'
  smtp_auth_password: 'your-password'
  smtp_require_tls: true

# 告警路由规则
route:
  # 默认接收者
  receiver: 'default'

  # 分组配置
  group_by: ['alertname', 'cluster', 'service']

  # 分组等待时间
  group_wait: 10s

  # 分组间隔
  group_interval: 10s

  # 重复告警间隔
  repeat_interval: 12h

  # 子路由
  routes:
    # 严重告警
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 5s
      repeat_interval: 1h

    # 警告告警
    - match:
        severity: warning
      receiver: 'warning-alerts'
      repeat_interval: 6h

    # 信息告警
    - match:
        severity: info
      receiver: 'info-alerts'
      repeat_interval: 24h

# 抑制规则 (避免告警风暴)
inhibit_rules:
  # 严重告警会抑制警告告警
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'namespace']

# 接收者配置
receivers:
  # 默认接收者
  - name: 'default'
    webhook_configs:
      - url: 'http://localhost:5001/webhook'
        send_resolved: true

  # 严重告警接收者
  - name: 'critical-alerts'
    email_configs:
      - to: 'oncall@example.com'
        headers:
          Subject: '[CRITICAL] RAG System Alert'
        text: '{{ range .Alerts }}{{ .Annotations.summary }}\n{{ .Annotations.description }}\n{{ end }}'
    webhook_configs:
      - url: 'http://localhost:5001/webhook/critical'
        send_resolved: true
    # 可选: 企业微信/钉钉/Slack 等
    # wechat_configs:
    #   - corp_id: 'your-corp-id'
    #     to_user: '@all'
    #     agent_id: 'your-agent-id'
    #     api_secret: 'your-api-secret'

  # 警告告警接收者
  - name: 'warning-alerts'
    email_configs:
      - to: 'team@example.com'
        headers:
          Subject: '[WARNING] RAG System Alert'
    webhook_configs:
      - url: 'http://localhost:5001/webhook/warning'
        send_resolved: true

  # 信息告警接收者
  - name: 'info-alerts'
    webhook_configs:
      - url: 'http://localhost:5001/webhook/info'
        send_resolved: true
